<!-- ============================================================
     EURO_GOALS v9.6.1 PRO+ â€” Unified History Data Viewer
     ÎšÎ±Î¸Î±ÏÎ® ÎµÎ¼Ï†Î¬Î½Î¹ÏƒÎ· Ï‡Ï‰ÏÎ¯Ï‚ Î±Î½Î±Ï†Î¿ÏÎ­Ï‚ ÏƒÎµ ÎµÎ¾Ï‰Ï„ÎµÏÎ¹ÎºÎ­Ï‚ Ï€Î·Î³Î­Ï‚
============================================================ -->
<section class="history-section bg-neutral-900/70 text-gray-100 rounded-xl shadow p-4 backdrop-blur-md">
  <header class="flex justify-between items-center mb-3">
    <div>
      <h2 class="text-xl font-semibold text-sky-400 mb-1">
        ğŸ“œ Î™ÏƒÏ„Î¿ÏÎ¹ÎºÎ¬ Î”ÎµÎ´Î¿Î¼Î­Î½Î±
      </h2>
      <p class="text-gray-400 text-sm">
        Î•Î½Î¿Ï€Î¿Î¹Î·Î¼Î­Î½Î± Î¹ÏƒÏ„Î¿ÏÎ¹ÎºÎ¬ Î±Î³ÏÎ½Ï‰Î½ Î±Ï€ÏŒ Ï„Î¿ ÏƒÏÏƒÏ„Î·Î¼Î± EURO_GOALS PRO+.
      </p>
    </div>
    <div class="flex gap-2">
      <button id="refreshHistory" class="text-xs px-3 py-1 bg-sky-700 text-white rounded hover:bg-sky-600 transition">
        ğŸ”„ Î‘Î½Î±Î½Î­Ï‰ÏƒÎ·
      </button>
      <button id="exportHistory" class="text-xs px-3 py-1 bg-emerald-700 text-white rounded hover:bg-emerald-600 transition">
        â¬‡ Î•Î¾Î±Î³Ï‰Î³Î® CSV
      </button>
    </div>
  </header>

  <!-- Î Î¯Î½Î±ÎºÎ±Ï‚ Î¹ÏƒÏ„Î¿ÏÎ¹ÎºÏÎ½ -->
  <div class="overflow-x-auto max-h-[600px] border-t border-gray-800">
    <table class="w-full text-sm border-collapse">
      <thead class="bg-gray-800 text-sky-400 sticky top-0">
        <tr>
          <th class="p-2 text-left">Î—Î¼ÎµÏÎ¿Î¼Î·Î½Î¯Î±</th>
          <th class="p-2 text-left">Î”Î¹Î¿ÏÎ³Î¬Î½Ï‰ÏƒÎ·</th>
          <th class="p-2 text-left">Î‘Î³ÏÎ½Î±Ï‚</th>
          <th class="p-2 text-right">Î‘Ï€Î¿Ï„Î­Î»ÎµÏƒÎ¼Î±</th>
        </tr>
      </thead>
      <tbody id="history-table-body" class="divide-y divide-gray-700 text-gray-200">
        <tr>
          <td colspan="4" class="p-3 text-center text-gray-400">Î¦ÏŒÏÏ„Ï‰ÏƒÎ· Î¹ÏƒÏ„Î¿ÏÎ¹ÎºÏÎ½ Î´ÎµÎ´Î¿Î¼Î­Î½Ï‰Î½...</td>
        </tr>
      </tbody>
    </table>
  </div>

  <footer class="text-xs text-gray-500 mt-3">
    * Î‘Ï…Ï„ÏŒÎ¼Î±Ï„Î· Î±Î½Î±Î½Î­Ï‰ÏƒÎ· ÎºÎ¬Î¸Îµ 60 Î´ÎµÏ…Ï„ÎµÏÏŒÎ»ÎµÏ€Ï„Î±.
  </footer>
</section>

<script>
  // ==============================
  // EURO_GOALS â€” Unified History Fetcher
  // ==============================
  async function loadHistoryData() {
    const tbody = document.getElementById("history-table-body");
    try {
      const resp = await fetch("/api/history");
      const data = await resp.json();
      const items = data.history || [];

      if (!items.length) {
        tbody.innerHTML = `<tr><td colspan="4" class="p-3 text-center text-gray-400">Î”ÎµÎ½ Ï…Ï€Î¬ÏÏ‡Î¿Ï…Î½ Î´Î¹Î±Î¸Î­ÏƒÎ¹Î¼Î± Î´ÎµÎ´Î¿Î¼Î­Î½Î±.</td></tr>`;
        return;
      }

      tbody.innerHTML = items.slice(0, 200).map(match => `
        <tr class="hover:bg-neutral-800/60 transition">
          <td class="p-2">${match.date || '-'}</td>
          <td class="p-2">${match.league || '-'}</td>
          <td class="p-2">${match.home_team || '-'} vs ${match.away_team || '-'}</td>
          <td class="p-2 text-right">${match.score || '-'}</td>
        </tr>
      `).join('');
    } catch (err) {
      tbody.innerHTML = `<tr><td colspan="4" class="p-3 text-center text-red-400">âš  Î£Ï†Î¬Î»Î¼Î± Ï†ÏŒÏÏ„Ï‰ÏƒÎ·Ï‚ Î¹ÏƒÏ„Î¿ÏÎ¹ÎºÏÎ½ Î´ÎµÎ´Î¿Î¼Î­Î½Ï‰Î½.</td></tr>`;
    }
  }

  document.getElementById("refreshHistory").addEventListener("click", loadHistoryData);
  loadHistoryData();
  setInterval(loadHistoryData, 60000);

  // ==============================
  // Î•Î¾Î±Î³Ï‰Î³Î® CSV
  // ==============================
  document.getElementById("exportHistory").addEventListener("click", async () => {
    const resp = await fetch("/api/history");
    const data = await resp.json();
    const items = data.history || [];
    if (!items.length) return alert("Î”ÎµÎ½ Ï…Ï€Î¬ÏÏ‡Î¿Ï…Î½ Î´ÎµÎ´Î¿Î¼Î­Î½Î± Î³Î¹Î± ÎµÎ¾Î±Î³Ï‰Î³Î®.");

    const csv = [
      ["Î—Î¼ÎµÏÎ¿Î¼Î·Î½Î¯Î±", "Î”Î¹Î¿ÏÎ³Î¬Î½Ï‰ÏƒÎ·", "Î‘Î³ÏÎ½Î±Ï‚", "Î‘Ï€Î¿Ï„Î­Î»ÎµÏƒÎ¼Î±"],
      ...items.map(m => [m.date, m.league, `${m.home_team} vs ${m.away_team}`, m.score])
    ].map(r => r.join(",")).join("\n");

    const blob = new Blob([csv], {type: "text/csv;charset=utf-8;"});
    const url = URL.createObjectURL(blob);
    const a = document.createElement("a");
    a.href = url;
    a.download = "eurogoals_history.csv";
    a.click();
    URL.revokeObjectURL(url);
  });
</script>
