{% extends "base.html" %}
{% block content %}

{% include "system_summary_bar.html" %}

<div class="container mx-auto p-4">
  <h1 class="text-3xl font-bold text-blue-400 mb-2 text-center">
    ⚙️ EURO_GOALS v9.4.4 PRO+ – Unified System Status
  </h1>
  <p class="text-center text-gray-400 mb-6">
    Πραγματικός χρόνος παρακολούθησης: DB • Render • Health • SmartMoney • Backup
  </p>

  <div id="status-grid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
    <!-- Τα status cards θα δημιουργούνται δυναμικά -->
  </div>

  <p id="last-update" class="text-center text-sm text-gray-400 mt-6">Τελευταία ενημέρωση: —</p>
</div>

<script>
async function loadStatus() {
  const grid = document.getElementById("status-grid");
  const last = document.getElementById("last-update");
  grid.innerHTML = `
    <div class="col-span-full text-center text-gray-400 animate-pulse">
      Φόρτωση δεδομένων...
    </div>
  `;

  try {
    const res = await fetch("/system_status_data");
    const data = await res.json();
    grid.innerHTML = "";

    for (const [key, value] of Object.entries(data)) {
      if (key === "last_update") continue;
      let color = "text-yellow-400";
      if (value.includes("OK")) color = "text-green-400";
      else if (value.includes("FAIL")) color = "text-red-400";

      const card = document.createElement("div");
      card.className =
        "status-card bg-gray-800/50 border border-gray-700 rounded-xl p-4 text-center shadow hover:scale-105 transition";
      card.innerHTML = `
        <h2 class="text-lg font-semibold text-blue-400 mb-1">${key}</h2>
        <p class="${color} font-bold">${value}</p>
      `;
      grid.appendChild(card);
    }

    last.innerText = "Τελευταία ενημέρωση: " + (data.last_update || "—");
  } catch (err) {
    console.error("[STATUS][ERR]", err);
    grid.innerHTML =
      '<p class="text-center text-red-400">⚠️ Σφάλμα φόρτωσης δεδομένων</p>';
  }
}

loadStatus();
setInterval(loadStatus, 30000);
</script>

{% endblock %}
