{% extends "base.html" %}
{% block content %}

<link rel="stylesheet" href="/static/css/unified_theme.css" />

{% include "system_summary_bar.html" %}

<div class="eg-container">
  <div class="eg-header">
    <h1>‚öôÔ∏è EURO_GOALS v9.5.0 PRO+ ‚Äî System Status</h1>
    <p class="eg-sub">Real-time status ‚Ä¢ DB ‚Ä¢ Health ‚Ä¢ Render ‚Ä¢ SmartMoney ‚Ä¢ Backup</p>
  </div>

  <div id="status-grid" class="eg-grid">
    <!-- dynamic cards -->
  </div>

  <div class="eg-footer-row">
    <a href="/control_panel" class="eg-btn eg-btn-primary">üõ† Control Panel</a>
    <a href="/system_logs" class="eg-btn eg-btn-secondary">üßæ System Logs</a>
    <span id="last-update" class="eg-last">Last update: ‚Äî</span>
  </div>
</div>

<script>
async function loadStatus() {
  const grid = document.getElementById("status-grid");
  const last = document.getElementById("last-update");
  grid.innerHTML = `<div class="eg-card eg-card-dim">Loading...</div>`;
  try {
    const res = await fetch("/system_status_data");
    const data = await res.json();
    grid.innerHTML = "";

    const entries = Object.entries(data).filter(([k]) => k !== "last_update");
    for (const [key, val] of entries) {
      let tone = "ok";
      const v = String(val);
      if (v.includes("Fail") || v.includes("Error") || v.includes("Offline")) tone = "bad";
      else if (v.includes("High Load") || v.includes("Inactive")) tone = "warn";

      const card = document.createElement("div");
      card.className = `eg-card eg-${tone}`;
      card.innerHTML = `
        <div class="eg-card-title">${key}</div>
        <div class="eg-card-body" title="${v}">${v}</div>
      `;
      grid.appendChild(card);
    }
    last.textContent = "Last update: " + (data.last_update || "‚Äî");
  } catch (e) {
    console.error("[STATUS][ERR]", e);
    grid.innerHTML = `<div class="eg-card eg-bad">‚ö†Ô∏è Error loading status</div>`;
  }
}

loadStatus();
setInterval(loadStatus, 30000);
</script>
{% endblock %}
