<!DOCTYPE html>
<html lang="el">
<head>
  <meta charset="UTF-8" />
  <title>EURO_GOALS v9.4.4 PRO+ Dashboard</title>
  <link rel="icon" href="/static/icons/ball.png" />
  <link rel="stylesheet" href="/static/style.css" />
  <style>
    :root{--bg:#0d1117;--fg:#e6edf3;--muted:#8b949e;--accent:#58a6ff;}
    body{background:var(--bg);color:var(--fg);font-family:"Segoe UI",Roboto,sans-serif;margin:0}
    header{background:#161b22;border-bottom:2px solid #30363d;text-align:center;padding:24px 10px}
    header h1{color:var(--accent);margin:0 0 8px}
    header p{color:var(--muted);margin:0;font-size:14px}
    .controls,.links{display:flex;justify-content:center;gap:10px;margin:16px auto}
    button{background:#2563eb;color:#fff;border:0;border-radius:8px;padding:10px 16px;cursor:pointer}
    button:hover{background:#1e40af}
    main{padding:24px;text-align:center}
    footer{text-align:center;margin-top:40px;padding:20px;color:#8b949e;border-top:1px solid #30363d}
  </style>
</head>
<body>

  {% include "system_summary_bar.html" %}

  <header>
    <h1>‚öΩ EURO_GOALS v9.4.4 PRO+ Dashboard</h1>
    <p>SmartMoney Heatmap ‚Ä¢ Browser Push Notifications</p>
  </header>

  <div class="controls">
    <button id="enablePush">üîî Enable Push</button>
    <button id="testPush">üß™ Test Push</button>
    <button onclick="location.href='/health'">‚ù§Ô∏è Health</button>
  </div>

  <main>
    <div class="links">
      <button onclick="location.href='/smartmoney/heatmap'">üü© Open SmartMoney Heatmap</button>
      <button onclick="location.href='/smartmoney/logs'">üí∞ SmartMoney Logs</button>
      <button onclick="location.href='/alert/history'">üìú Alert History</button>
    </div>
  </main>

  <footer>EURO_GOALS v9.4.4 PRO+ | Build: 04/11/2025</footer>

  <script>
    // --- Service worker register ---
    async function regSW(){
      if(!('serviceWorker' in navigator)) return null;
      try { return await navigator.serviceWorker.register('/service-worker.js'); }
      catch(e){ console.error('SW register failed', e); return null; }
    }

    // --- Convert base64url to Uint8Array (for VAPID key) ---
    function urlBase64ToUint8Array(base64String) {
      const padding = '='.repeat((4 - base64String.length % 4) % 4);
      const base64 = (base64String + padding).replace(/-/g, '+').replace(/_/g, '/');
      const rawData = atob(base64); const out = new Uint8Array(rawData.length);
      for (let i=0;i<rawData.length;i++) out[i] = rawData.charCodeAt(i);
      return out;
    }

    async function enablePush(){
      try{
        const reg = await regSW();
        if(!reg || !('PushManager' in window)) { alert('Push not supported'); return; }
        const { publicKey } = await (await fetch('/push/public_key')).json();
        const sub = await reg.pushManager.subscribe({
          userVisibleOnly: true,
          applicationServerKey: urlBase64ToUint8Array(publicKey)
        });
        await fetch('/push/subscribe',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify(sub)});
        alert('Push enabled ‚úÖ');
      }catch(e){ console.error(e); alert('Enable Push failed'); }
    }

    async function testPush(){
      const r = await fetch('/push/test',{method:'POST'});
      const j = await r.json();
      if(j.ok) alert('Test push sent ('+(j.sent||0)+')');
      else alert('Push not configured on server');
    }

    document.getElementById('enablePush').onclick = enablePush;
    document.getElementById('testPush').onclick = testPush;
  </script>
</body>
</html>
