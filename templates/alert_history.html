<!DOCTYPE html>
<html lang="el">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Alert History â€“ EURO_GOALS v9.4.3 PRO+</title>
  <link rel="icon" href="/static/icons/ball.png">
  <link rel="stylesheet" href="/static/style.css">
  <style>
    :root {
      --bg-dark: #0d1117;
      --bg-light: #f5f5f5;
      --text-dark: #e6edf3;
      --text-light: #222;
      --accent: #58a6ff;
    }

    body {
      background-color: var(--bg-dark);
      color: var(--text-dark);
      font-family: "Segoe UI", Roboto, sans-serif;
      margin: 0;
      padding: 0;
      transition: background 0.3s, color 0.3s;
    }

    header {
      background-color: #161b22;
      border-bottom: 2px solid #30363d;
      text-align: center;
      padding: 20px 10px;
    }

    header h1 { color: var(--accent); margin-bottom: 5px; }
    header p { color: #8b949e; margin: 0; font-size: 14px; }

    .controls {
      display: flex;
      justify-content: center;
      gap: 10px;
      margin: 15px auto;
    }

    .controls button {
      background: #2563eb;
      color: white;
      border: none;
      border-radius: 8px;
      padding: 8px 14px;
      cursor: pointer;
      font-size: 14px;
      transition: background 0.2s;
    }
    .controls button:hover { background: #1e40af; }

    main {
      padding: 25px;
      max-width: 1100px;
      margin: auto;
    }

    .filter-bar {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      margin-bottom: 20px;
      justify-content: center;
    }

    select, input[type="text"], button.refresh-btn {
      padding: 8px;
      border-radius: 6px;
      border: 1px solid #30363d;
      background-color: #161b22;
      color: #e6edf3;
    }

    .alert-table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 10px;
    }

    .alert-table th, .alert-table td {
      border: 1px solid #30363d;
      padding: 8px;
      text-align: left;
    }

    .alert-table th {
      background-color: #21262d;
      color: var(--accent);
    }

    .alert-table tr:nth-child(even) { background-color: #161b22; }
    .alert-table tr:hover { background-color: #30363d; }

    .flash { animation: highlight 1.5s ease; }
    @keyframes highlight {
      from { background-color: #1f6feb; }
      to { background-color: transparent; }
    }

    footer {
      text-align: center;
      margin-top: 40px;
      padding: 20px;
      border-top: 1px solid #30363d;
      color: #8b949e;
      font-size: 14px;
    }

    body.light {
      background-color: var(--bg-light);
      color: var(--text-light);
    }
  </style>
</head>

<body>

  {% include "system_summary_bar.html" %}

  <header>
    <h1>ğŸ“œ EURO_GOALS v9.4.3 PRO+ â€“ Alert History</h1>
    <p>Î ÏÎ¿Î²Î¿Î»Î® SmartMoney / Goals / System Alerts ÏƒÎµ Ï€ÏÎ±Î³Î¼Î±Ï„Î¹ÎºÏŒ Ï‡ÏÏŒÎ½Î¿</p>
  </header>

  <div class="controls">
    <button onclick="location.href='/'">ğŸ  Dashboard</button>
    <button id="muteBtn">ğŸ”Š Mute</button>
    <button id="modeBtn">ğŸŒ™ Dark</button>
    <button id="refreshBtn">ğŸ” Refresh</button>
  </div>

  <main>
    <div class="filter-bar">
      <input type="text" id="searchBox" placeholder="Î‘Î½Î±Î¶Î®Ï„Î·ÏƒÎ·...">
      <select id="typeFilter">
        <option value="all">ÎŒÎ»ÎµÏ‚ Î¿Î¹ ÎµÎ¹Î´Î¿Ï€Î¿Î¹Î®ÏƒÎµÎ¹Ï‚</option>
        <option value="smart">ğŸ’° Smart Money</option>
        <option value="goal">âš½ Goal Alerts</option>
        <option value="system">âš™ï¸ System Events</option>
      </select>
    </div>

    <table class="alert-table" id="alertTable">
      <thead>
        <tr>
          <th>ÎÏÎ±</th>
          <th>Î¤ÏÏ€Î¿Ï‚</th>
          <th>Î›ÎµÏ€Ï„Î¿Î¼Î­ÏÎµÎ¹ÎµÏ‚</th>
        </tr>
      </thead>
      <tbody id="alertRows">
        <!-- Î•Î¹ÏƒÎ±Î³Ï‰Î³Î® Î´ÎµÎ´Î¿Î¼Î­Î½Ï‰Î½ -->
      </tbody>
    </table>

    <p style="text-align:right; font-size:13px; color:#8b949e; margin-top:10px;">
      ğŸ•“ Î¤ÎµÎ»ÎµÏ…Ï„Î±Î¯Î± ÎµÎ½Î·Î¼Î­ÏÏ‰ÏƒÎ·: <span id="last-update">â€”</span>
    </p>
  </main>

  <footer>
    EURO_GOALS v9.4.3 PRO+ | Alert History | Build: 04/11/2025
  </footer>

  <script>
    // =============================================================
    // ALERT HISTORY â€“ Ultimate UI Edition (Mute / Mode / Auto)
    // =============================================================

    const rows = document.getElementById("alertRows");
    const typeFilter = document.getElementById("typeFilter");
    const searchBox = document.getElementById("searchBox");
    const refreshBtn = document.getElementById("refreshBtn");
    const lastUpdateEl = document.getElementById("last-update");
    const muteBtn = document.getElementById("muteBtn");
    const modeBtn = document.getElementById("modeBtn");

    let muted = localStorage.getItem("smartmoneyMuted") === "true";
    let darkMode = localStorage.getItem("smartmoneyDark") !== "false";
    document.body.classList.toggle("light", !darkMode);
    modeBtn.textContent = darkMode ? "ğŸŒ™ Dark" : "â˜€ï¸ Light";
    muteBtn.textContent = muted ? "ğŸ”‡ Unmute" : "ğŸ”Š Mute";

    async function fetchAlerts() {
      try {
        const r = await fetch("/smartmoney/history?limit=100");
        const j = await r.json();
        const items = j.items || [];
        renderAlerts(items);
        lastUpdateEl.textContent = new Date().toLocaleTimeString("el-GR", { hour12: false });
        if (!muted) new Audio("/static/sounds/alert.mp3").play();
      } catch (e) {
        console.error("Fetch error:", e);
      }
    }

    function renderAlerts(alerts) {
      const query = searchBox.value.toLowerCase();
      const filter = typeFilter.value;
      rows.innerHTML = "";

      alerts
        .filter(a => (filter === "all" || (filter === "smart" && a.source) || (filter === "goal" && a.detail?.includes("Goal")) || (filter === "system" && a.detail?.includes("Render"))))
        .filter(a => a.detail?.toLowerCase().includes(query))
        .forEach(a => {
          const tr = document.createElement("tr");
          const dt = new Date(a.ts_utc).toLocaleTimeString("el-GR", { hour12: false });
          const type = a.source ? "ğŸ’° SmartMoney" : "âš™ï¸ System";
          const detail = a.detail || `${a.home} vs ${a.away} (${a.bookmaker})`;
          tr.innerHTML = `<td>${dt}</td><td>${type}</td><td>${detail}</td>`;
          rows.appendChild(tr);
        });
    }

    // ========== CONTROLS ==========
    muteBtn.onclick = () => {
      muted = !muted;
      localStorage.setItem("smartmoneyMuted", muted);
      muteBtn.textContent = muted ? "ğŸ”‡ Unmute" : "ğŸ”Š Mute";
    };

    modeBtn.onclick = () => {
      darkMode = !darkMode;
      localStorage.setItem("smartmoneyDark", darkMode);
      document.body.classList.toggle("light", !darkMode);
      modeBtn.textContent = darkMode ? "ğŸŒ™ Dark" : "â˜€ï¸ Light";
    };

    refreshBtn.onclick = fetchAlerts;
    typeFilter.onchange = fetchAlerts;
    searchBox.oninput = fetchAlerts;

    document.addEventListener("keydown", e => {
      if (e.key.toLowerCase() === "r") fetchAlerts();
      if (e.key.toLowerCase() === "m") muteBtn.click();
      if (e.key.toLowerCase() === "l") modeBtn.click();
    });

    // ========== AUTO REFRESH ==========
    fetchAlerts();
    setInterval(fetchAlerts, 60000);
  </script>

</body>
</html>
