{% extends "base.html" %}
{% block content %}

{% include "system_summary_bar.html" %}

<div class="container mx-auto p-4">
  <h1 class="text-3xl font-bold text-center text-blue-400 mb-2">
    ğŸ“œ EURO_GOALS v9.4.4 PRO+ â€“ Alert History
  </h1>
  <p class="text-center text-gray-400 mb-6">
    Î ÏÎ¿Î²Î¿Î»Î® SmartMoney / Goals / System Alerts ÏƒÎµ Ï€ÏÎ±Î³Î¼Î±Ï„Î¹ÎºÏŒ Ï‡ÏÏŒÎ½Î¿
  </p>

  <div class="flex justify-center gap-2 mb-4">
    <button id="btn-dashboard" class="px-4 py-2 bg-blue-500 hover:bg-blue-600 text-white rounded-xl shadow">ğŸ  Dashboard</button>
    <button id="btn-mute" class="px-4 py-2 bg-gray-600 hover:bg-gray-700 text-white rounded-xl shadow">ğŸ”‡ Mute</button>
    <button id="btn-dark" class="px-4 py-2 bg-gray-800 hover:bg-gray-900 text-white rounded-xl shadow">ğŸŒ™ Dark</button>
    <button id="btn-refresh" class="px-4 py-2 bg-green-500 hover:bg-green-600 text-white rounded-xl shadow">ğŸ” Refresh</button>
  </div>

  <div class="flex justify-between items-center mb-3">
    <input
      type="text"
      id="search"
      placeholder="Î‘Î½Î±Î¶Î®Ï„Î·ÏƒÎ·..."
      class="w-1/3 p-2 rounded-lg border border-gray-700 bg-gray-900 text-gray-100"
    />
    <select id="filter-type" class="p-2 rounded-lg border border-gray-700 bg-gray-900 text-gray-100">
      <option value="all">ÎŒÎ»ÎµÏ‚ Î¿Î¹ ÎµÎ¹Î´Î¿Ï€Î¿Î¹Î®ÏƒÎµÎ¹Ï‚</option>
      <option value="smartmoney">SmartMoney</option>
      <option value="system">System</option>
      <option value="goal">Goals</option>
    </select>
    <span class="text-gray-400 text-sm">ğŸ•’ Î¤ÎµÎ»ÎµÏ…Ï„Î±Î¯Î± ÎµÎ½Î·Î¼Î­ÏÏ‰ÏƒÎ·: <span id="last-refresh">â€”</span></span>
  </div>

  <table class="w-full text-left text-gray-200 border-t border-gray-700">
    <thead class="bg-gray-800 text-gray-300 uppercase text-sm">
      <tr>
        <th class="py-2 px-3 w-1/6">ÎÏÎ±</th>
        <th class="py-2 px-3 w-1/6">Î¤ÏÏ€Î¿Ï‚</th>
        <th class="py-2 px-3">Î›ÎµÏ€Ï„Î¿Î¼Î­ÏÎµÎ¹ÎµÏ‚</th>
      </tr>
    </thead>
    <tbody id="alerts-body" class="text-sm divide-y divide-gray-700"></tbody>
  </table>
</div>

<footer class="text-center text-gray-500 text-xs mt-6">
  EURO_GOALS v9.4.4 PRO+ â€¢ Alert History | Build: 04/11/2025
</footer>

<script>
let autoRefresh = true;
const REFRESH_INTERVAL = 60; // sec

async function loadAlerts() {
  try {
    const res = await fetch("/api/alerts");
    const data = await res.json();
    const tbody = document.getElementById("alerts-body");
    tbody.innerHTML = "";
    for (const a of data.alerts) {
      const row = document.createElement("tr");
      row.className = "hover:bg-gray-800";
      row.innerHTML = `
        <td class="py-2 px-3">${new Date(a.event_time).toLocaleTimeString()}</td>
        <td class="py-2 px-3">${a.league || "SmartMoney"}</td>
        <td class="py-2 px-3">${a.team || "-"} | Î”: ${a.delta_odds.toFixed(2)} | Î•Î½Ï„.: ${a.intensity.toFixed(2)}</td>
      `;
      tbody.appendChild(row);
    }
    document.getElementById("last-refresh").innerText = new Date().toLocaleTimeString();
  } catch (err) {
    console.error("[ALERT_HISTORY][ERR]", err);
  }
}

document.getElementById("btn-refresh").addEventListener("click", loadAlerts);
document.getElementById("btn-dashboard").addEventListener("click", () => {
  window.location.href = "/";
});
document.getElementById("btn-dark").addEventListener("click", () => {
  document.body.classList.toggle("bg-gray-900");
});

setInterval(() => {
  if (autoRefresh) loadAlerts();
}, REFRESH_INTERVAL * 1000);

window.addEventListener("DOMContentLoaded", loadAlerts);
</script>

{% endblock %}
