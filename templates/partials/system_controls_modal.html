<!-- ========================================================= -->
<!-- EURO_GOALS PRO+ â€” SYSTEM CONTROLS MODAL (v9.6.8 + PWA Tools) -->
<!-- ========================================================= -->

<div id="system-controls-modal"
     class="hidden fixed inset-0 bg-black/70 flex items-center justify-center z-50">
  <div class="bg-neutral-900 rounded-2xl shadow-xl p-6 w-[90%] max-w-md text-gray-200">
    <h3 class="text-lg font-semibold text-sky-400 mb-4">âš™ï¸ EURO_GOALS PRO+ â€” System Controls</h3>

    <div class="flex flex-col gap-3">

      <!-- ğŸ” Refresh All Engines -->
      <button onclick="refreshAllEngines()" class="py-2 px-4 rounded bg-emerald-600 text-black font-semibold hover:bg-emerald-500 transition">
        ğŸ” Refresh Engines
      </button>

      <!-- ğŸ“¦ Reload Matchplan -->
      <button onclick="reloadMatchplan()" class="py-2 px-4 rounded bg-sky-500 text-black font-semibold hover:bg-sky-400 transition">
        ğŸ“¦ Reload Matchplan
      </button>

      <!-- ğŸ“Š Reload Standings -->
      <button onclick="reloadStandings()" class="py-2 px-4 rounded bg-indigo-500 text-black font-semibold hover:bg-indigo-400 transition">
        ğŸ“Š Reload Standings
      </button>

      <!-- ğŸ§¹ NEW: Clear PWA Cache -->
      <button onclick="clearPWACache()" class="py-2 px-4 rounded bg-amber-400 text-black font-semibold hover:bg-amber-300 transition">
        ğŸ§¹ Clear PWA Cache / Reload App
      </button>

      <!-- âŒ Close Button -->
      <button onclick="toggleControls(false)" class="py-2 px-4 rounded bg-red-600 text-white font-semibold hover:bg-red-500 transition">
        âŒ Close
      </button>
    </div>
  </div>
</div>

<!-- ========================================================= -->
<!-- JS LOGIC -->
<!-- ========================================================= -->
<script>
  function toggleControls(show = true) {
    document.getElementById("system-controls-modal").style.display = show ? "flex" : "none";
  }

  async function refreshAllEngines() {
    alert("ğŸ”„ Refreshing all active engines...");
    try {
      await fetch("/api/history");
      await fetch("/api/matchplan");
      await fetch("/api/standings");
      alert("âœ… Engines refreshed successfully!");
    } catch (e) {
      alert("âš ï¸ Error refreshing engines: " + e.message);
    }
  }

  async function reloadMatchplan() {
    try {
      const res = await fetch("/api/matchplan");
      if (res.ok) alert("âœ… Matchplan reloaded.");
      else alert("âš ï¸ Matchplan reload failed.");
    } catch {
      alert("âš ï¸ Matchplan reload error.");
    }
  }

  async function reloadStandings() {
    try {
      const res = await fetch("/api/standings");
      if (res.ok) alert("âœ… Standings reloaded.");
      else alert("âš ï¸ Standings reload failed.");
    } catch {
      alert("âš ï¸ Standings reload error.");
    }
  }

  // ------------------------------------------------------------
  // ğŸ§¹ Clear PWA Cache + Force Reload
  // ------------------------------------------------------------
  async function clearPWACache() {
    const confirmClear = confirm("Î˜ÎµÏ‚ Î½Î± ÎºÎ±Î¸Î±ÏÎ¯ÏƒÎµÎ¹Ï‚ Ï„Î¿ PWA cache ÎºÎ±Î¹ Î½Î± Î³Î¯Î½ÎµÎ¹ ÎµÏ€Î±Î½ÎµÎºÎºÎ¯Î½Î·ÏƒÎ·;");
    if (!confirmClear) return;

    // Î”Î¹Î±Î³ÏÎ±Ï†Î® Service Worker
    if ("serviceWorker" in navigator) {
      const regs = await navigator.serviceWorker.getRegistrations();
      for (let reg of regs) {
        await reg.unregister();
        console.log("[EURO_GOALS] ğŸ§¹ Unregistered SW:", reg.scope);
      }
    }

    // Î”Î¹Î±Î³ÏÎ±Ï†Î® Cache Storage
    if ("caches" in window) {
      const names = await caches.keys();
      for (let name of names) {
        await caches.delete(name);
        console.log("[EURO_GOALS] ğŸ§¹ Deleted cache:", name);
      }
    }

    alert("âœ… Cache ÎºÎ±Î¸Î±ÏÎ¯ÏƒÏ„Î·ÎºÎµ. Î•Ï€Î±Î½Î±Ï†ÏŒÏÏ„Ï‰ÏƒÎ·...");
    window.location.reload(true);
  }
</script>
