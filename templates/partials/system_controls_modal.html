<!-- ============================================================
     EURO_GOALS v9.3.4 â€“ System Controls Modal (separate)
     ============================================================ -->
<style>
  .eg-modal-overlay{
    position: fixed; inset: 0; background: rgba(0,0,0,.55);
    opacity: 0; pointer-events: none; transition: opacity .2s ease;
    z-index: 60;
  }
  .eg-modal-overlay.active{ opacity: 1; pointer-events: auto; }
  .eg-modal{
    position: fixed; inset: 0; display: grid; place-items: center; z-index: 61;
    opacity: 0; pointer-events: none; transition: opacity .2s ease;
  }
  .eg-modal.active{ opacity: 1; pointer-events: auto; }
  .eg-card{
    width: min(680px, 92vw); background: #161b22; color:#e6edf3; border:1px solid #30363d;
    border-radius: 14px; padding: 18px; box-shadow: 0 10px 30px rgba(0,0,0,.35);
  }
  .eg-card h3{ margin: 0 0 10px; color:#58a6ff; }
  .eg-actions{ display:flex; gap: 8px; flex-wrap: wrap; margin: 12px 0 4px; }
  .eg-actions .btn{ padding: 10px 12px; border-radius:10px; border:1px solid #30363d; background:#21262d; color:#e6edf3; cursor:pointer; }
  .eg-actions .btn:hover{ background:#2b3138; }
  .tag{ display:inline-block; font-size:12px; padding:3px 8px; border-radius:999px; border:1px solid #30363d; margin-left:6px; }
  .tag.ok{ color:#00e676; border-color:#1f513a; background:#0f2d20; }
  .tag.warn{ color:#ffd54f; border-color:#5b4b1f; background:#2b250f; }
  .tag.err{ color:#ff5252; border-color:#6b1f1f; background:#2b0f0f; }
  .eg-list{ background:#0d1117; border:1px solid #30363d; border-radius:10px; padding:10px; max-height:220px; overflow:auto; font-size:13px; }
  .eg-list-item{ display:flex; justify-content:space-between; padding:6px 4px; border-bottom:1px dashed #30363d; }
  .eg-list-item:last-child{ border-bottom:none; }
  .eg-row{ display:flex; gap:8px; align-items:center; flex-wrap:wrap; }
  .eg-spacer{ height:8px; }
  .eg-right{ text-align:right; }
  .eg-modal-close{ float:right; cursor:pointer; opacity:.8; }
  .eg-modal-close:hover{ opacity:1; }
</style>

<div id="eg-controls-overlay" class="eg-modal-overlay"></div>
<div id="eg-controls-modal" class="eg-modal" role="dialog" aria-modal="true" aria-labelledby="eg-controls-title">
  <div class="eg-card">
    <div>
      <span id="close-controls-modal" class="eg-modal-close">âœ–</span>
      <h3 id="eg-controls-title">âš™ï¸ System Controls</h3>
    </div>

    <div class="eg-row">
      <button class="btn" id="btn-force-refresh">ğŸ” Force Refresh Now</button>
      <button class="btn" id="btn-toggle-autorefresh">â¯ Auto-Refresh: <span id="autorefresh-state">ON</span></button>
      <button class="btn" id="btn-check-modules">ğŸ§© Check Modules</button>
      <button class="btn" id="btn-view-logs">ğŸ“œ View System Logs</button>
    </div>

    <div class="eg-spacer"></div>

    <div class="eg-row">
      <div>SmartMoney: <span id="tag-sm" class="tag warn">checkingâ€¦</span></div>
      <div>GoalMatrix: <span id="tag-gm" class="tag warn">checkingâ€¦</span></div>
      <div>Render: <span id="tag-rd" class="tag warn">checkingâ€¦</span></div>
      <div>DB: <span id="tag-db" class="tag warn">checkingâ€¦</span></div>
    </div>

    <div class="eg-spacer"></div>

    <div class="eg-list" id="eg-logs">
      <!-- Î³ÎµÎ¼Î¯Î¶ÎµÎ¹ Î´Ï…Î½Î±Î¼Î¹ÎºÎ¬ Î¼Îµ Ï„Î± Ï„ÎµÎ»ÎµÏ…Ï„Î±Î¯Î± checks -->
    </div>
  </div>
</div>

<script>
  // Modal open/close
  const $open = document.getElementById("open-controls-modal");
  const $modal = document.getElementById("eg-controls-modal");
  const $overlay = document.getElementById("eg-controls-overlay");
  const $close = document.getElementById("close-controls-modal");

  function openModal(){ $modal.classList.add("active"); $overlay.classList.add("active"); }
  function closeModal(){ $modal.classList.remove("active"); $overlay.classList.remove("active"); }

  $open?.addEventListener("click", openModal);
  $close?.addEventListener("click", closeModal);
  $overlay?.addEventListener("click", closeModal);

  // Hooks Î¼Îµ Ï„Î¿ global script (system_summary.js)
  document.addEventListener("summary-updated", async () => {
    // Î–Î®Ï„Î± Ï†ÏÎ­ÏƒÎºÎ± Î´ÎµÎ´Î¿Î¼Î­Î½Î±
    const sys = await fetch("/system_status_data").then(r=>r.json()).catch(()=>null);
    const sm  = await fetch("/smartmoney_data").then(r=>r.json()).catch(()=>null);
    const gm  = await fetch("/goalmatrix_data").then(r=>r.json()).catch(()=>null);

    const setTag = (el, val) => {
      if(!el) return;
      el.classList.remove("ok","warn","err");
      const s = String(val||"").toLowerCase();
      if (s.includes("ok") || s.includes("active") || s.includes("online")) { el.classList.add("ok"); el.textContent = "OK"; }
      else if (s.includes("fail") || s.includes("error") || s.includes("offline")) { el.classList.add("err"); el.textContent = "FAIL"; }
      else { el.classList.add("warn"); el.textContent = "â€”"; }
    };

    setTag(document.getElementById("tag-sm"), sm?.status);
    setTag(document.getElementById("tag-gm"), gm?.status);
    setTag(document.getElementById("tag-rd"), sys?.render ?? sys?.status);
    setTag(document.getElementById("tag-db"), sys?.database);

    // Î ÏÎ¿ÏƒÎ¸Î®ÎºÎ· Ï€ÏÏŒÏ‡ÎµÎ¹ÏÏ‰Î½ logs (Î­Ï„Î¿Î¹Î¼Î¿ Î³Î¹Î± Î±Î½Ï„Î¹ÎºÎ±Ï„Î¬ÏƒÏ„Î±ÏƒÎ· Î¼Îµ /system_logs)
    const box = document.getElementById("eg-logs");
    if (box) {
      const now = new Date().toLocaleTimeString("el-GR",{hour:"2-digit",minute:"2-digit",second:"2-digit"});
      const line = document.createElement("div");
      line.className = "eg-list-item";
      line.innerHTML = `<span>${now}</span><span>DB:${sys?.database} Â· RD:${sys?.render??sys?.status} Â· SM:${sm?.status} Â· GM:${gm?.status}</span>`;
      box.prepend(line);
      // ÎºÏÎ¬Ï„Î± Î¼Î­Ï‡ÏÎ¹ 20
      while (box.children.length > 20) box.removeChild(box.lastChild);
    }
  });

  // ÎšÎ¿Ï…Î¼Ï€Î¹Î¬ ÎµÎ½ÎµÏÎ³ÎµÎ¹ÏÎ½
  const $btnForce = document.getElementById("btn-force-refresh");
  const $btnToggle = document.getElementById("btn-toggle-autorefresh");
  const $btnModules = document.getElementById("btn-check-modules");
  const $btnLogs = document.getElementById("btn-view-logs");
  const $state = document.getElementById("autorefresh-state");

  // Î¤Î± Ï€Î±ÏÎ±ÎºÎ¬Ï„Ï‰ hooks Â«Î¼Î¹Î»Î¬Î½ÎµÂ» Î¼Îµ system_summary.js (global)
  $btnForce?.addEventListener("click", () => {
    if (window.updateSystemSummary) window.updateSystemSummary();
  });
  $btnToggle?.addEventListener("click", () => {
    if (typeof window.toggleAutoRefresh === "function") {
      const on = window.toggleAutoRefresh();
      if ($state) $state.textContent = on ? "ON" : "OFF";
    }
  });
  $btnModules?.addEventListener("click", async () => {
    // Î‘Ï€Î»Î® ÎµÏ€Î±Î»Î®Î¸ÎµÏ…ÏƒÎ· endpoints
    try {
      await Promise.all([fetch("/system_status_data"), fetch("/smartmoney_data"), fetch("/goalmatrix_data")]);
      alert("ğŸ§© Modules reachable.");
    } catch { alert("âš ï¸ Some module did not respond."); }
  });
  $btnLogs?.addEventListener("click", () => {
    // Placeholder: ÏƒÏ„Î¿ ÎµÏ€ÏŒÎ¼ÎµÎ½Î¿ Î²Î®Î¼Î± Î¸Î± ÎºÎ±Î»Î­ÏƒÎ¿Ï…Î¼Îµ /system_logs
    alert("ğŸ“œ System Logs placeholder â€“ Î¸Î± ÏƒÏ…Î½Î´ÎµÎ¸ÎµÎ¯ ÏƒÏ„Î¿ /system_logs ÏƒÏ„Î¿ ÎµÏ€ÏŒÎ¼ÎµÎ½Î¿ build.");
  });
</script>
