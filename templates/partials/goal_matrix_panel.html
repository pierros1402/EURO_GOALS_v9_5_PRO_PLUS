<!-- ============================================================
     EURO_GOALS PRO+ v9.5.5 â€“ GoalMatrix Panel (Unified Expansion)
     Î•Î½Î¿Ï€Î¿Î¹Î·Î¼Î­Î½Î¿ dashboard Î³Î¹Î± GoalMatrix Engine
============================================================ -->
<section class="card goalmatrix-panel bg-neutral-900/70 text-gray-100 rounded-xl shadow p-3 backdrop-blur-md transition-all">
  <header class="flex justify-between items-center mb-2">
    <h3 class="text-lg font-semibold text-sky-400">âš½ GoalMatrix Engine</h3>
    <span id="gm-status-pill" class="px-2 py-1 rounded text-xs bg-gray-600 text-white">Loading...</span>
  </header>

  <div class="flex flex-wrap justify-between text-sm mb-2 text-gray-300">
    <span id="gm-summary-total">Matches: 0</span>
    <span id="gm-summary-avg">Avg xG: 0.00</span>
    <span id="gm-summary-time">Last update: --:--:--</span>
    <button id="gm-refresh" class="text-xs px-2 py-1 bg-sky-700 text-white rounded hover:bg-sky-600 transition">
      ğŸ”„ Refresh
    </button>
  </div>

  <div class="table-container overflow-x-auto max-h-[420px]">
    <table class="w-full text-sm border-collapse">
      <thead class="bg-gray-800 text-sky-400 sticky top-0 z-10">
        <tr>
          <th class="p-2 text-left">League</th>
          <th class="p-2 text-left">Match</th>
          <th class="p-2 text-right">xG Home</th>
          <th class="p-2 text-right">xG Away</th>
          <th class="p-2 text-right">Exp Goals</th>
          <th class="p-2 text-center">Tendency</th>
        </tr>
      </thead>
      <tbody id="gm-body" class="divide-y divide-gray-700 text-gray-200">
        <tr>
          <td colspan="6" class="p-2 text-center text-gray-400">Î¦ÏŒÏÏ„Ï‰ÏƒÎ· Î´ÎµÎ´Î¿Î¼Î­Î½Ï‰Î½ GoalMatrix...</td>
        </tr>
      </tbody>
    </table>
  </div>

  <footer class="text-xs text-gray-500 mt-2">
    * Î‘Ï…Ï„ÏŒÎ¼Î±Ï„Î· ÎµÎ½Î·Î¼Î­ÏÏ‰ÏƒÎ· ÎºÎ¬Î¸Îµ 30 s â€“ GoalMatrix Unified API Feed
  </footer>
</section>

<script>
  // ============================================================
  // GOALMATRIX PANEL SCRIPT â€“ EURO_GOALS v9.5.5 PRO+ Unified Expansion
  // ============================================================

  async function loadGoalMatrixData() {
    const body = document.getElementById("gm-body");
    const pill = document.getElementById("gm-status-pill");
    try {
      const resp = await fetch("/api/goalmatrix/summary");
      const data = await resp.json();

      // Î‘Î½Ï„Î±Ï€ÏŒÎºÏÎ¹ÏƒÎ· / Î´ÎµÎ´Î¿Î¼Î­Î½Î±
      const items = data?.summary || [];
      pill.textContent = "ON";
      pill.className = "px-2 py-1 rounded text-xs bg-green-500 text-black font-semibold";

      if (items.length === 0) {
        body.innerHTML = `<tr><td colspan="6" class="p-2 text-center text-gray-400">No GoalMatrix data available.</td></tr>`;
      } else {
        body.innerHTML = items
          .map(
            (m) => `
          <tr class="hover:bg-neutral-800/60 transition">
            <td class="p-2">${m.league || "-"}</td>
            <td class="p-2">${m.match || "-"}</td>
            <td class="p-2 text-right">${m.xg_home?.toFixed?.(2) ?? "â€“"}</td>
            <td class="p-2 text-right">${m.xg_away?.toFixed?.(2) ?? "â€“"}</td>
            <td class="p-2 text-right">${m.expected_goals?.toFixed?.(2) ?? "â€“"}</td>
            <td class="p-2 text-center ${
              m.tendency === "Home"
                ? "text-green-400"
                : m.tendency === "Away"
                ? "text-red-400"
                : "text-yellow-300"
            }">${m.tendency || "â€“"}</td>
          </tr>`
          )
          .join("");
      }

      // summary
      const avgXG =
        items.length > 0
          ? (items.reduce((acc, m) => acc + (m.expected_goals || 0), 0) / items.length).toFixed(2)
          : "0.00";

      document.getElementById("gm-summary-total").textContent = `Matches: ${items.length}`;
      document.getElementById("gm-summary-avg").textContent = `Avg xG: ${avgXG}`;
      document.getElementById("gm-summary-time").textContent =
        "Last update: " + new Date().toLocaleTimeString("el-GR", { hour12: false });
    } catch (err) {
      console.warn("[EURO_GOALS] GoalMatrix fetch error:", err);
      pill.textContent = "OFF";
      pill.className = "px-2 py-1 rounded text-xs bg-red-600 text-white";
      body.innerHTML = `<tr><td colspan="6" class="p-2 text-center text-gray-400">âš  Î£Ï†Î¬Î»Î¼Î± Ï†ÏŒÏÏ„Ï‰ÏƒÎ·Ï‚ Î´ÎµÎ´Î¿Î¼Î­Î½Ï‰Î½.</td></tr>`;
    }
  }

  document.getElementById("gm-refresh")?.addEventListener("click", loadGoalMatrixData);
  window.addEventListener("load", loadGoalMatrixData);
  setInterval(loadGoalMatrixData, 30000);
</script>
