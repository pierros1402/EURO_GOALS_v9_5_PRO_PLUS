<!DOCTYPE html>
<html lang="el">
<head>
  <meta charset="UTF-8">
  <title>ğŸ“¡ EURO_GOALS â€“ Admin Feeds Monitor</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="icon" href="/static/icon_blue.png">
  <link rel="stylesheet" href="/static/css/style_dark.css">

  <style>
    /* âš™ï¸ ALERT CONTROL BAR */
    #alert-controls {
      display: flex;
      justify-content: center;
      gap: 20px;
      background-color: #161616;
      padding: 10px;
      border-radius: 8px;
      border: 1px solid #333;
      margin: 15px auto;
      width: fit-content;
      box-shadow: 0 0 6px rgba(0,255,174,0.1);
    }

    #alert-controls label {
      color: #ccc;
      font-size: 14px;
      cursor: pointer;
      display: flex;
      align-items: center;
      gap: 6px;
    }

    #alert-controls input[type="checkbox"] {
      transform: scale(1.2);
      accent-color: #00ffae;
      cursor: pointer;
    }
  </style>
</head>
<body>

  <h1>ğŸ“¡ Admin Feeds Panel</h1>

  <!-- ğŸ”” Alert Control Bar -->
  <div id="alert-controls">
    <label><input type="checkbox" id="alertSmartMoney" checked> SmartMoney Alerts</label>
    <label><input type="checkbox" id="alertSystem" checked> System Alerts</label>
    <label><input type="checkbox" id="alertFeeds" checked> Feeds Alerts</label>
    <label><input type="checkbox" id="alertBrowser" checked> Browser Notifications</label>
  </div>

  <table>
    <thead>
      <tr>
        <th>Feed</th>
        <th>ÎšÎ±Ï„Î¬ÏƒÏ„Î±ÏƒÎ·</th>
        <th>Î¤ÎµÎ»ÎµÏ…Ï„Î±Î¯Î± ÎµÎ½Î·Î¼Î­ÏÏ‰ÏƒÎ·</th>
        <th>Î›ÎµÏ€Ï„Î¿Î¼Î­ÏÎµÎ¹ÎµÏ‚</th>
      </tr>
    </thead>
    <tbody id="feedTable">
      <tr><td colspan="4">Î¦ÏŒÏÏ„Ï‰ÏƒÎ· Î´ÎµÎ´Î¿Î¼Î­Î½Ï‰Î½...</td></tr>
    </tbody>
  </table>

  <div id="timestamp">Î‘Î½Î±Î¼Î¿Î½Î® Î´ÎµÎ´Î¿Î¼Î­Î½Ï‰Î½...</div>
  <div class="status-bar">Î‘Ï…Ï„ÏŒÎ¼Î±Ï„Î· ÎµÎ½Î·Î¼Î­ÏÏ‰ÏƒÎ· ÎºÎ¬Î¸Îµ 60 Î´ÎµÏ…Ï„ÎµÏÏŒÎ»ÎµÏ€Ï„Î±</div>

  <audio id="alertSound" src="/static/sounds/smartmoney_alert.mp3" preload="auto"></audio>

  <script>
    // ğŸ”§ LocalStorage ÎµÏ€Î¹Î»Î¿Î³Î­Ï‚
    const controls = ["alertSmartMoney", "alertSystem", "alertFeeds", "alertBrowser"];
    controls.forEach(id => {
      const checkbox = document.getElementById(id);
      const saved = localStorage.getItem(id);
      if (saved === "off") checkbox.checked = false;
      checkbox.addEventListener("change", () => {
        localStorage.setItem(id, checkbox.checked ? "on" : "off");
      });
    });

    const audio = document.getElementById("alertSound");
    let lastStatuses = {};

    async function loadFeeds() {
      try {
        const response = await fetch("/feeds_status");
        const data = await response.json();
        const tbody = document.getElementById("feedTable");
        tbody.innerHTML = "";

        data.forEach(feed => {
          const row = document.createElement("tr");
          row.className = feed.status === "OK" ? "normal" : 
                          feed.status === "PENDING" ? "normal" : "alert";

          // Î‘Î½ Î±Î»Î»Î¬Î¾ÎµÎ¹ ÏƒÎµ FAIL ÎºÎ±Î¹ ÎµÎ¯Î½Î±Î¹ ÎµÎ½ÎµÏÎ³ÏŒ Ï„Î¿ Feeds Alerts â†’ Î®Ï‡Î¿Ï‚
          if (feed.status === "FAIL" && lastStatuses[feed.name] !== "FAIL") {
            if (localStorage.getItem("alertFeeds") === "on") {
              audio.currentTime = 0;
              audio.play().catch(()=>{});
            }
            if (localStorage.getItem("alertBrowser") === "on" && "Notification" in window) {
              if (Notification.permission === "granted") {
                new Notification(`âŒ Feed Failure`, {
                  body: `${feed.name} â€“ ${feed.details}`,
                  icon: "/static/icon_red.png"
                });
              } else if (Notification.permission !== "denied") {
                Notification.requestPermission();
              }
            }
          }

          lastStatuses[feed.name] = feed.status;

          row.innerHTML = `
            <td>${feed.name}</td>
            <td>${feed.status}</td>
            <td>${feed.last_update}</td>
            <td>${feed.details}</td>
          `;
          tbody.appendChild(row);
        });

        document.getElementById("timestamp").innerText =
          "Î¤ÎµÎ»ÎµÏ…Ï„Î±Î¯Î± ÎµÎ½Î·Î¼Î­ÏÏ‰ÏƒÎ·: " + new Date().toLocaleTimeString("el-GR");

      } catch (err) {
        console.error("Î£Ï†Î¬Î»Î¼Î± Ï†ÏŒÏÏ„Ï‰ÏƒÎ·Ï‚ Feeds:", err);
        document.getElementById("feedTable").innerHTML =
          `<tr class="alert"><td colspan="4">âŒ Î£Ï†Î¬Î»Î¼Î± ÏƒÏÎ½Î´ÎµÏƒÎ·Ï‚ Î¼Îµ /feeds_status</td></tr>`;
      }
    }

    loadFeeds();
    setInterval(loadFeeds, 60000);
  </script>

  <div class="footer">
    EURO_GOALS Admin Feeds Monitor v8.9i Â© 2025
  </div>

</body>
</html>
